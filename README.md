import streamlit as st
from PIL import Image, ImageDraw, ImageFont
import io

st.set_page_config(page_title="í•™êµ ì„±ê²© í…ŒìŠ¤íŠ¸", page_icon="ğŸ«")

st.title("ğŸ« í•™êµì—ì„œì˜ ë‚´ ì´ë¯¸ì§€ ì„±ê²© í…ŒìŠ¤íŠ¸")

# --------------------------
# ì§ˆë¬¸ ë°ì´í„°
# --------------------------
questions = [
    {
        "q": "1. ì‰¬ëŠ” ì‹œê°„ì— ë‚˜ëŠ” ë³´í†µ?",
        "options": {
            "ì¹œêµ¬ë“¤ê³¼ ë– ë“¤ë©° ë…¼ë‹¤": "star",
            "ì±…ì„ ì½ê±°ë‚˜ ê³µë¶€í•œë‹¤": "model",
            "ì¹œêµ¬ë“¤í•œí…Œ ì¥ë‚œì¹˜ë©° ì›ƒê¸´ë‹¤": "funny",
            "ê·¸ë¦¼ ê·¸ë¦¬ê±°ë‚˜ ìŒì•… ë“£ëŠ”ë‹¤": "artist",
            "ìš´ë™ì¥ì—ì„œ ê³µì„ ì°¬ë‹¤": "sports",
            "ì¹œêµ¬ ê³ ë¯¼ì„ ë“¤ì–´ì¤€ë‹¤": "healer"
        }
    },
    {
        "q": "2. ì ì‹¬ì‹œê°„, ê¸‰ì‹ ì¤„ ì„¤ ë•Œ ë‚˜ëŠ”?",
        "options": {
            "ì¹œêµ¬ë‘ ì‹ ë‚˜ê²Œ ìˆ˜ë‹¤": "star",
            "ì¡°ìš©íˆ ìˆœì„œ ê¸°ë‹¤ë¦¼": "model",
            "ì•ë’¤ ì¹œêµ¬ë‘ ì¥ë‚œ": "funny",
            "ë…¸ë˜ í¥ì–¼ê±°ë¦¼": "artist",
            "ë¹¨ë¦¬ ë¨¹ê³  ìš´ë™ì¥ ê°€ì•¼ì§€!": "sports",
            "ì¹œêµ¬ ìë¦¬ ì±™ê²¨ì¤Œ": "healer"
        }
    },
    {
        "q": "3. ì¡°ë³„ í™œë™í•  ë•Œ ë‚˜ëŠ”?",
        "options": {
            "ë¦¬ë” ë§¡ì•„ì„œ ì´ëŒê¸°": "star",
            "ì„±ì‹¤í•˜ê²Œ ë§¡ì€ ì¼ í•˜ê¸°": "model",
            "ë¶„ìœ„ê¸° ë„ìš°ëŠ” ê°œê·¸ ë‹´ë‹¹": "funny",
            "ì•„ì´ë””ì–´ ë‚´ëŠ” ì°½ì˜ ë‹´ë‹¹": "artist",
            "í˜ë“  ì¼ ì²™ì²™ í•´ëƒ„": "sports",
            "ê°ˆë“± ì¡°ì •í•˜ê³  ë„ì™€ì¤Œ": "healer"
        }
    },
    {
        "q": "4. ì‹œí—˜ì´ ëë‚œ ë‚  ë‚˜ëŠ”?",
        "options": {
            "ì¹œêµ¬ë“¤ì´ë‘ ë†€ëŸ¬ ë‚˜ê°„ë‹¤": "star",
            "ë„ì„œê´€ì—ì„œ ìê¸°ê³„ë°œ": "model",
            "ì¹œêµ¬ë“¤ ë†€ë¦¬ë©° ë†ë‹´": "funny",
            "ì§‘ì—ì„œ ê·¸ë¦¼/ìŒì•…": "artist",
            "ìš´ë™ì¥ì—ì„œ ë•€ ë¹¼ê¸°": "sports",
            "ì¹œêµ¬ ìœ„ë¡œí•˜ë©° ê°™ì´ ì‰¼": "healer"
        }
    },
    {
        "q": "5. ì¹œêµ¬ê°€ ìŠ¬í¼í•  ë•Œ ë‚˜ëŠ”?",
        "options": {
            "ê°™ì´ ì›ƒê¸°ë©´ì„œ ê¸°ë¶„ í’€ì–´ì¤Œ": "funny",
            "ë”°ëœ»í•˜ê²Œ ìœ„ë¡œí•´ì¤Œ": "healer",
            "ì˜†ì—ì„œ ì¡°ìš©íˆ ìˆì–´ì¤Œ": "model",
            "ì¬ë°ŒëŠ” ê³³ ê°™ì´ ê°€ìê³  í•¨": "star",
            "ê·¸ë¦¼/ë…¸ë˜ë¡œ ìœ„ë¡œí•¨": "artist",
            "ìš´ë™ ê°™ì´ í•˜ìê³  í•¨": "sports"
        }
    },
    {
        "q": "6. í•™êµ í–‰ì‚¬ì—ì„œ ë‚˜ëŠ”?",
        "options": {
            "ë¬´ëŒ€ì— ì˜¬ë¼ê°€ì„œ ê³µì—°": "star",
            "ë’¤ì—ì„œ ë¬µë¬µíˆ ë•ê¸°": "model",
            "ì‚¬íšŒë‚˜ ì§„í–‰ ë§¡ê¸°": "funny",
            "í¬ìŠ¤í„°ë‚˜ ê¾¸ë¯¸ê¸° ë‹´ë‹¹": "artist",
            "ì²´ìœ¡ëŒ€íšŒ ì£¼ì¸ê³µ": "sports",
            "ë„ì›€ í•„ìš”í•œ ê³³ ì±™ê¹€": "healer"
        }
    },
    {
        "q": "7. ì¹œêµ¬ë“¤ì´ ë‚  ë¶€ë¥´ëŠ” ë§ì€?",
        "options": {
            "í•µì¸ì‹¸": "star",
            "ëª¨ë²”ìƒ": "model",
            "ê°œê·¸ë§¨": "funny",
            "ì˜ˆìˆ ê°€": "artist",
            "ìš´ë™ë¶€": "sports",
            "ì²œì‚¬": "healer"
        }
    },
    {
        "q": "8. ê°€ì¥ ì¢‹ì•„í•˜ëŠ” ìˆ˜ì—…ì€?",
        "options": {
            "ë°œí‘œ/í† ë¡  ìˆ˜ì—…": "star",
            "ìˆ˜í•™Â·êµ­ì–´ ê°™ì€ ì£¼ìš”ê³¼ëª©": "model",
            "í™œë™ ë§ì€ ìˆ˜ì—…": "funny",
            "ë¯¸ìˆ Â·ìŒì•…": "artist",
            "ì²´ìœ¡": "sports",
            "ë´‰ì‚¬í™œë™Â·ìƒë‹´": "healer"
        }
    }
]

# --------------------------
# ì ìˆ˜ ì´ˆê¸°í™”
# --------------------------
scores = {"star":0, "model":0, "funny":0, "artist":0, "sports":0, "healer":0}

# --------------------------
# ì§ˆë¬¸ ì¶œë ¥
# --------------------------
for q in questions:
    st.subheader(q["q"])
    choice = st.radio("ì„ íƒí•˜ì„¸ìš”:", list(q["options"].keys()), key=q["q"])
    if choice:
        scores[q["options"][choice]] += 1

# --------------------------
# ê²°ê³¼ ì„¤ëª… & ì•„ì´ì½˜
# --------------------------
result_texts = {
    "star": ("â­ ì¸ê¸°ìŠ¤íƒ€í˜•!", "ì¹œêµ¬ë“¤ê³¼ ì˜ ì–´ìš¸ë¦¬ê³  ì£¼ëª©ë°›ëŠ” ì¸ê¸°ì¸ì…ë‹ˆë‹¤."),
    "model": ("ğŸ“š ëª¨ë²”ìƒí˜•!", "ì„±ì‹¤í•˜ê³  ì¡°ìš©íˆ í•  ì¼ì„ í•´ë‚´ëŠ” ì‹ ë¢°ë°›ëŠ” í•™ìƒì…ë‹ˆë‹¤."),
    "funny": ("ğŸ­ ê°œê·¸ìºí˜•!", "ì£¼ë³€ì„ ì¦ê²ê²Œ ë§Œë“œëŠ” ë¶„ìœ„ê¸° ë©”ì´ì»¤ì…ë‹ˆë‹¤."),
    "artist": ("ğŸ¨ ì•„í‹°ìŠ¤íŠ¸í˜•!", "ê°œì„±ê³¼ ì°½ì˜ë ¥ì´ ë‹ë³´ì´ëŠ” íŠ¹ë³„í•œ í•™ìƒì…ë‹ˆë‹¤."),
    "sports": ("âš½ ìš´ë™ë¶€ ì—ì´ìŠ¤í˜•!", "ì—´ì •ì ì´ê³  í™œë°œí•œ ìŠ¤í¬ì¸ í˜• í•™ìƒì…ë‹ˆë‹¤."),
    "healer": ("ğŸ€ íëŸ¬í˜•!", "ë°°ë ¤ì‹¬ ë§ê³  ì¹œêµ¬ë“¤ì„ ë”°ëœ»í•˜ê²Œ ì±™ê¸°ëŠ” í•™ìƒì…ë‹ˆë‹¤."),
}

result_icons = {
    "star": "https://cdn-icons-png.flaticon.com/512/616/616490.png",
    "model": "https://cdn-icons-png.flaticon.com/512/3135/3135755.png",
    "funny": "https://cdn-icons-png.flaticon.com/512/742/742751.png",
    "artist": "https://cdn-icons-png.flaticon.com/512/4333/4333609.png",
    "sports": "https://cdn-icons-png.flaticon.com/512/1046/1046784.png",
    "healer": "https://cdn-icons-png.flaticon.com/512/3448/3448610.png",
}

# --------------------------
# ê²°ê³¼ ë³´ê¸° ë²„íŠ¼
# --------------------------
if st.button("ê²°ê³¼ ë³´ê¸°"):
    result = max(scores, key=scores.get)
    title, desc = result_texts[result]

    st.image(result_icons[result], width=120)
    st.success(f"{title}\n{desc}")

    # --------------------------
    # ì¹´ë“œë‰´ìŠ¤ ì´ë¯¸ì§€ ìƒì„± í•¨ìˆ˜
    # --------------------------
    def create_card(title, desc):
        img = Image.new("RGB", (600, 800), color=(255, 255, 255))
        draw = ImageDraw.Draw(img)

        try:
            font_title = ImageFont.truetype("arial.ttf", 40)
            font_desc = ImageFont.truetype("arial.ttf", 28)
        except:
            font_title = ImageFont.load_default()
            font_desc = ImageFont.load_default()

        draw.text((50, 100), title, font=font_title, fill=(0, 0, 0))
        draw.text((50, 200), desc, font=font_desc, fill=(50, 50, 50))

        return img

    card_img = create_card(title, desc)

    # ì´ë¯¸ì§€ í™”ë©´ì— í‘œì‹œ
    st.image(card_img, caption="ğŸ“¢ ê³µìœ ìš© ì¹´ë“œë‰´ìŠ¤")

    # ë‹¤ìš´ë¡œë“œ ë²„íŠ¼
    buf = io.BytesIO()
    card_img.save(buf, format="PNG")
    byte_im = buf.getvalue()

    st.download_button(
        label="ğŸ“¥ ì¹´ë“œë‰´ìŠ¤ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ",
        data=byte_im,
        file_name="school_personality_card.png",
        mime="image/png"
    )
